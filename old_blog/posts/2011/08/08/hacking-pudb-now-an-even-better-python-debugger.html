<!DOCTYPE html><html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Aaron Meurer">
    <title>Hacking PuDB: Now an even better Python debugger | Aaron Meurer's SymPy Blog</title>
    
            <link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
    <link rel="canonical" href="http://asmeurersympy.wordpress.com/posts/2011/08/08/hacking-pudb-now-an-even-better-python-debugger.html">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
            <link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../rss.xml">

    





    
</head>
<body>
<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://asmeurersympy.wordpress.com/">Aaron Meurer's SymPy Blog</a>
    </div>
    <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav">
            
                <li><a href="../../../../archive.html">Archives</a>
                </li><li><a href="../../../../categories/index.html">Tags</a>
                </li><li><a href="../../../../rss.xml">RSS</a>

        </li></ul>

        <ul class="nav navbar-nav navbar-right">
            
            
        </ul>
    </div><!-- /.navbar-collapse -->
</nav>

<!-- End of Menubar -->

<div class="container">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
    <article class="postbox post-text">
    <div class="h-entry" itemscope="itemscope" itemtype="http://schema.org/Article">
    
    <h1 class="p-name" itemprop="headline name">Hacking PuDB: Now an even better Python debugger</h1>

    <hr>
    <small>
        Posted: <time class="published dt-published" datetime="2011-08-08T03:16:10+00:00" itemprop="datePublished">2011-08-08 03:16</time>
        

        

    </small>
    <hr>
    <div class="e-content" itemprop="articleBody text">
    <div><p></p><p>Readers of this blog may remember last year when I <a href="http://asmeurersympy.wordpress.com/2010/06/04/pudb-a-better-python-debugger/" target="_blank">wrote</a> about this awesome visual console Python debugger called <a href="http://pypi.python.org/pypi/pudb" target="_blank">PuDB</a>.  I suggest you read that post if you haven't.</p>
<p>At the end of that post, I noted that Ondřej and I had hacked it to make the colors more livable.  Well, a couple of weeks ago, GitHub user <a href="https://github.com/jtriley" target="_blank">jtriley</a> sent me an email asking me to back port my changes.</p>
<p>A lot has changed since I wrote my blog post last year.  PuDB now has an official <a href="http://lists.tiker.net/listinfo/pudb" target="_blank">mailing list</a> and an official <a href="https://github.com/inducer/pudb" target="_blank">GitHub repo</a>.</p>
<p>So I deleted my <a href="https://github.com/asmeurer/pudb" target="_blank">GitHub clone</a> and reforked from the official version.  </p>
<p>A lot has also changed in the official code.  Andreas had added config support, including a built-in prefs dialog that lets you set a few settings:  the ability to turn on or off line numbers and the ability to change themes.</p>
<p>So I took the new code and added my theme as an official theme.  This was pretty straight forward to do.</p>
<p>But then, I got a little carried away.  </p>
<p>I noticed that it was difficult to choose a theme with the built-in prefs window because you had to close and reopen the window each time you made a change.  So I added code to make it auto-update your changes as you made them.</p>
<p>Then I went back and looked at my original blog post and looked at the things that I didn't like.  There were two things.  First, the default stringifier for variables is <code>type</code>, which is completely useless.  This is because <code>type</code> is very fast and stable to compute.  I had previously hacked this to be <code>str</code>, but now that there was an official config file with a prefs dialog, I figured it should go there. </p>
<p>So I added support to change this setting.  But this wasn't enough for me.  I also added the ability to define your own custom stringifier.  You just create a Python file that defines a function called <code>pudb_stringifier(obj)</code>, which converts <code>obj</code> into the desired string representation.  I included an <a href="https://github.com/inducer/pudb/blob/master/example-stringifier.py" target="_blank">example file</a> that gives a fancy example that uses signals to compute the string value, but times out after one second and falls back to the type.  This alleviates one of the problems of using <code>str</code>, which is that it can be slow for objects with large string expressions, especially SymPy objects, where sometimes the printer can be slow.</p>
<p>The second thing I didn't like was that although you can change the width of the right-hand side bar, you could not change the relative heights of the variables, stack, and breakpoints boxes.  I never use breakpoints, and rarely use the stack, so I would prefer to have those smaller and the variables larger.  So I implemented it so that the <code>[</code> and <code>]</code> keys make the selected view smaller or larger.  This information is all saved in the config file, so it's remembered when you close and reopen PuDB.</p>
<p>There was one other thing that I didn't like, which a change since my last blog post that reversed the order of the stack variables from what it was.  It used to be most recent at the bottom, but it was changed to most recent at the top.  This perhaps makes more sense, but the buttons to move around the stack, <code>u</code> and <code>d</code>, were still the same: <code>u</code> moves down the stack (i.e., less recent), and <code>d</code> moves up.  These keys were already well established—indeed, these are the same keys used in Python's built-in debugger pdb—so I added a setting to change the stack order.  This was an easy change to make at this point, as I was already well aquatinted with the settings code, and only two lines of code needed to be changed when the setting changed.  Like all other settings, this uses the cool magic that changes the setting in real time, so you can see the effect without closing the settings window.</p>
<p>Then someone on the mailing list requested a feature that I realized I also wanted, the ability to wrap variables.  Previously, any variable that was longer than the variable view would just be cut off.  You could make it wider, but that only helped a little bit.  Otherwise, if you wanted to see the whole variable, you had to open IPython by pressing <code>!</code> and view it there.</p>
<p>So, I implemented this.  This was definitely the hardest thing to implement.  I found out that it's ironically very difficult to debug PuDB itself.  You can't run PuDB inside of PuDB if PuDB crashes, as both instances will just crash.  Also, PuDB eats any print statements.  The solution, suggested by PuDB author Andreas Klöckner, was to get the ttys file of another terminal (e.g., <code>/dev/ttys012</code>) and write the output to that.</p>
<p>I also made it so that non-wrapped variables show <code>...</code> at the end, at Andreas's suggestion.  I wanted to use the unicode <code>…</code>, but this was not working at all.  I discovered how much unicode really is a mess in Python 2.  The problem has something to do with … being a three byte character, and I think it also has to do with the color codes that urwid uses.  I'll try it again once PuDB is ported to Python 3, but for now,  we are going to have to do with the three ascii dots.</p>
<p>The wrapping code is waiting for merge, but the rest are already in.  Here is a screen shot demonstrating some of the things I did:</p>
<p><a href="../../../../2011/08/screen-shot-2011-08-07-at-8-28-11-pm.png"><img src="http://asmeurersympy.files.wordpress.com/2011/08/screen-shot-2011-08-07-at-8-28-11-pm.png?w=300" alt="" title="Improved PuDB" width="300" height="245" class="size-medium wp-image-1021"></a></p>
<p>Things that I implemented to notice here:</p>
<ul>
<li>
<p>The midnight theme.</p>
</li>
<li>
<p>The stack and breakpoints views have been shrunken.</p>
</li>
<li>
<p>The variables are wrapped.</p>
</li>
<li>
<p>Wrapping for the variable <code>fourhundred</code> has been turned off (you can turn wrapping on or off on a per-variable basis by selecting the variable and pressing <code>w</code>).   Notice that there is an ellipsis at the end to note it has been cut off.</p>
</li>
<li>
<p>Nested variables now have <code>|</code> before them, to distinguish them from wrapped variables, which are also indented.  This change may or may not be accepted by Andreas.</p>
</li>
</ul>
<p>Here's a screen shot showing the prefs window.  I did not implement this, but I did implement all but the first two preferences in the window. I've made my window tall so you can see all the options.  You really have to get the code and try it to see the auto-update awesomeness.  You can open the prefs window by pressing <code>Ctrl-p</code> (this was not at all obvious to me the first time I used it, so I also submitted a patch that makes it open the first time you use PuDB).</p>
<p><a href="../../../../2011/08/screen-shot-2011-08-07-at-8-41-30-pm.png"><img src="http://asmeurersympy.files.wordpress.com/2011/08/screen-shot-2011-08-07-at-8-41-30-pm.png?w=243" alt="" title="PuDB Prefs Window" width="243" height="300" class="size-medium wp-image-1023"></a></p>
<p>So if you're not already using this awesome Python debugger, you should.  You can <code>pip install pudb</code>, or <a href="https://github.com/inducer/pudb" target="_blank">fork it</a> at GitHub.</p>
<p>Running it in your code is very easy.  Just add</p>
<p>[code lang="py"]</p>
<p>import pudb;pudb.set_trace()</p>
<p>[/code]</p>
<p>in your code wherever you want to set a break point, or you can do <code>python -m pudb.run script.py</code>.</p>
<p>This awesome tool has increased my productivity tenfold since I discovered it, and has helped me track down bugs that would have otherwise extremely difficult if not impossible to find.  And now, it's just better.</p>
<p>PuDB uses the <a href="http://excess.org/urwid/" target="_blank">urwid library</a> to do all its console GUI magic.  This library makes it pretty easy to do a lot of stuff. For example, it automatically does relative sizing of widgets, so, for example, when you resize the variables, stack, or breakpoints views, you are actually increasing the relative size of each, not the size in characters.  This makes it portable against any terminal size.  The library also made coding the prefs window autoupdate magic very easy.</p>
<p>Also, I just want to note that git and GitHub make collaboration like this very easy.  I just forked his project, made some improvements, and submitted them as pull requests.  Then it was easy to discuss the changes.  If the code had not been on GitHub and especially if it had not been in git, I probably would have never bothered to submit my contributions upstream.  I highly recommend that every open source project use git and GitHub.</p></div>
    </div>
    </div>
    
        <ul class="pager">
            <li class="previous">
                <a href="../../07/30/sympy-0-7-1-released.html" rel="prev">← Previous post</a>
            </li>
            <li class="next">
                <a href="../18/sqrtx-now-prints-as-sqrtx.html" rel="next">Next post →</a>
            </li>
        </ul>

        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="asmeurer",
            disqus_url="http://asmeurersympy.wordpress.com/posts/2011/08/08/hacking-pudb-now-an-even-better-python-debugger.html",
        disqus_title="Hacking PuDB: Now an even better Python debugger",
        disqus_identifier="cache/posts/2011/08/08/hacking-pudb-now-an-even-better-python-debugger.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    

    </article>

        </div>
        <!--End of body content-->

        <footer>
            Contents © 2014         <a href="mailto:asmeurer@gmail.com">Aaron Meurer</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
        </footer>
    </div>
</div>


            <script src="../../../../assets/js/all-nocdn.js" type="text/javascript"></script>


    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul><li><a class="addthis_button_facebook"></a>
</li><li><a class="addthis_button_google_plusone_share"></a>
</li><li><a class="addthis_button_linkedin"></a>
</li><li><a class="addthis_button_twitter"></a>
</li></ul>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
    

</body>
</html>