<!DOCTYPE html><html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Aaron Meurer">
    <title>Infinitely nested lists in Python | Aaron Meurer's SymPy Blog</title>
    
            <link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
    <link rel="canonical" href="http://asmeurersympy.wordpress.com/posts/2012/09/19/infinitely-nested-lists-in-python.html">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
            <link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../rss.xml">

    





    
</head>
<body>
<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://asmeurersympy.wordpress.com/">Aaron Meurer's SymPy Blog</a>
    </div>
    <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav">
            
                <li><a href="../../../../archive.html">Archives</a>
                </li><li><a href="../../../../categories/index.html">Tags</a>
                </li><li><a href="../../../../rss.xml">RSS</a>

        </li></ul>

        <ul class="nav navbar-nav navbar-right">
            
            
        </ul>
    </div><!-- /.navbar-collapse -->
</nav>

<!-- End of Menubar -->

<div class="container">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
    <article class="postbox post-text">
    <div class="h-entry" itemscope="itemscope" itemtype="http://schema.org/Article">
    
    <h1 class="p-name" itemprop="headline name">Infinitely nested lists in Python</h1>

    <hr>
    <small>
        Posted: <time class="published dt-published" datetime="2012-09-19T04:21:08+00:00" itemprop="datePublished">2012-09-19 04:21</time>
        

        

    </small>
    <hr>
    <div class="e-content" itemprop="articleBody text">
    <div><p></p><p>Readers of this blog know that I sometimes like to write about some <a href="http://asmeurersympy.wordpress.com/2009/07/20/modifying-a-list-while-looping-through-it-in-python/">strange</a>, <a href="http://asmeurersympy.wordpress.com/2010/06/16/strange-python-behavior-can-someone-please-explain-to-me-what-is-going-on-here/">unexpected</a>, and <a href="http://asmeurersympy.wordpress.com/2011/03/15/true-is-true-is-false-is-true-is-false/">unusual</a> things in Python that I stumble across.  This post is another one of those.</p>
<p>First, look at this</p>
<p>[code language="py"]</p>
<p>&gt;&gt;&gt; a = []</p>
<p>&gt;&gt;&gt; a.append(a)</p>
<p>&gt;&gt;&gt; a</p>
<p>[[...]]</p>
<p>[/code]</p>
<p>What am I doing here?  I'm creating a list, <code>a</code>, and I'm adding it to itself.  What you end up with is an infinitely nested list.  The first interesting thing about this is that Python is smart enough to not explode when printing this list.  The following should convince you that <code>a</code> does indeed contain itself.</p>
<p>[code language="py"]</p>
<p>&gt;&gt;&gt; a[0] is a</p>
<p>True</p>
<p>&gt;&gt;&gt; a[0] == a</p>
<p>True</p>
<p>[/code]</p>
<p>Now, if you have programmed in C, or a similar language that uses pointers, this should not come as a surprise to you.  Lists in Python, like most things, do not actually contain the items inside them.  Rather, they contain references (in C terminology, "pointers") to the items inside them.  From this perspective, there is no issue at all with <code>a</code> containing a pointer to itself.</p>
<p>The first thing I wondered when I saw this was just how clever the printer was at noticing that the list was infinitely nested.  What if we make the cycle a little more complex?</p>
<p>[code language="py"]</p>
<p>&gt;&gt;&gt; a = []</p>
<p>&gt;&gt;&gt; b = []</p>
<p>&gt;&gt;&gt; a.append(b)</p>
<p>&gt;&gt;&gt; b.append(a)</p>
<p>&gt;&gt;&gt; a</p>
<p>[[[...]]]</p>
<p>&gt;&gt;&gt; b</p>
<p>[[[...]]]</p>
<p>&gt;&gt;&gt; a[0] is b</p>
<p>True</p>
<p>&gt;&gt;&gt; b[0] is a</p>
<p>True</p>
<p>[/code]</p>
<p>So it still works.  I had thought that maybe repr just catches <code>RuntimeError</code> and falls back to printing <code>...</code> when the list is nested too deeply, but it turns out that is not true:</p>
<p>[code language="py"]</p>
<p>&gt;&gt;&gt; a = []</p>
<p>&gt;&gt;&gt; for i in range(10000):</p>
<p>...     a = [a]</p>
<p>... </p>
<p>&gt;&gt;&gt; a</p>
<p>Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
RuntimeError: maximum recursion depth exceeded while getting the repr of a list</p>
<p>[/code]</p>
<p>And by the way, in case you were wondering, it is possible to catch a <code>RuntimeError</code> (using the same <code>a</code> as the previous code block)</p>
<p>[code language="py"]</p>
<p>&gt;&gt;&gt; try:</p>
<p>...     print(a)</p>
<p>... except RuntimeError:</p>
<p>...     print("no way")</p>
<p>... </p>
<p>no way</p>
<p>[/code]</p>
<p>(and you also may notice that this is Python 3. Things behave the same way in Python 2)</p>
<p>Back to infinitely nested lists, we saw that printing works, but there are some things that don't work.</p>
<p>[code language="py"]</p>
<p>&gt;&gt;&gt; a[0] == b</p>
<p>True</p>
<p>&gt;&gt;&gt; a[0] == a</p>
<p>Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
RuntimeError: maximum recursion depth exceeded in comparison</p>
<p>[/code]</p>
<p><code>a[0] is b</code> holds (i.e., they are exactly the same object in memory), so <code>==</code> is able to short-circuit on them.  But to test <code>a[0] == a</code> it has to recursively compare the elements of <code>a</code> and <code>a[0]</code>.  Since it is infinitely nested, this leads to a recursion error.  Now an interesting question: why does this happen?  Is it because <code>==</code> on lists uses a depth first search?  If it were somehow possible to compare these two objects, would they be equal?</p>
<p>One is reminded of <a href="http://en.wikipedia.org/wiki/Russel%27s_paradox">Russel's paradox</a>, and the reason why in <a href="http://en.wikipedia.org/wiki/Zermelo%E2%80%93Fraenkel_set_theory">axiomatic set theory</a>, sets are not allowed to contain themselves. </p>
<p>Thinking of this brought me to my final question.  Is it possible to make a Python <code>set</code> that contains itself?  The answer is obviously no, because <code>set</code> objects can only contain hashable objects, and <code>set</code> is not hashable.  But <code>frozenset</code>, <code>set</code>'s counterpart, is hashable.  So can you create a <code>frozenset</code> that contains itself?  The same for <code>tuple</code>.  The method I used for <code>a</code> above won't work, because <code>a</code> must be mutable to append it to itself.</p>
<p></p></div>
    </div>
    </div>
    
        <ul class="pager">
            <li class="previous">
                <a href="../../08/31/isympy-i-a-saner-interactive-environment.html" rel="prev">← Previous post</a>
            </li>
            <li class="next">
                <a href="../../12/30/2012-in-review.html" rel="next">Next post →</a>
            </li>
        </ul>

        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="asmeurer",
            disqus_url="http://asmeurersympy.wordpress.com/posts/2012/09/19/infinitely-nested-lists-in-python.html",
        disqus_title="Infinitely nested lists in Python",
        disqus_identifier="cache/posts/2012/09/19/infinitely-nested-lists-in-python.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    

    </article>

        </div>
        <!--End of body content-->

        <footer>
            Contents © 2014         <a href="mailto:asmeurer@gmail.com">Aaron Meurer</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
        </footer>
    </div>
</div>


            <script src="../../../../assets/js/all-nocdn.js" type="text/javascript"></script>


    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul><li><a class="addthis_button_facebook"></a>
</li><li><a class="addthis_button_google_plusone_share"></a>
</li><li><a class="addthis_button_linkedin"></a>
</li><li><a class="addthis_button_twitter"></a>
</li></ul>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
    

</body>
</html>