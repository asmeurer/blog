<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns#
        article: http://ogp.me/ns/article#
    " lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Refactoring Expand | Aaron Meurer's SymPy Blog</title>

    
            <link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">

    
            <link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../rss.xml">

      <link rel="canonical" href="http://asmeurersympy.wordpress.com/posts/2009/06/21/refactoring-expand.html">



    
        <!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]-->

    


    

    <meta name="author" content="Aaron Meurer">
    
        <meta name="og:title" content="Refactoring Expand">
        <meta name="og:url" content="http://asmeurersympy.wordpress.com/posts/2009/06/21/refactoring-expand.html">
            <meta name="og:description" content="So I have spent the past week refactoring expand so that you can have more control over what expansion methods you use.  With the present method, expand takes in hints which defaults to basic.  basic ">
        <meta name="og:site_name" content="Aaron Meurer's SymPy Blog">
        <meta name="og:type" content="article">

    

    



</head>
<body>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://asmeurersympy.wordpress.com/">Aaron Meurer's SymPy Blog</a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                
                <li>
<a href="../../../../archive.html">Archives</a>
                </li>
<li>
<a href="../../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../../rss.xml">RSS</a>

            </li>
</ul>

            <ul class="nav navbar-nav navbar-right">
                
                
                    
    <li>
    <a href="refactoring-expand.wp" id="sourcelink">Source</a>
    </li>

            </ul>
        </div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container-fluid -->
</nav>

<!-- End of Menubar -->

<div class="container">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
    
    <header>
        
    <h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Refactoring Expand</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Aaron Meurer</span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2009-06-21T04:48:54+00:00" itemprop="datePublished" title="Publication date">2009-06-21 04:48</time></a></p>
                <p class="commentline">
        
    <a href="refactoring-expand.html#disqus_thread" data-disqus-identifier="cache/posts/2009/06/21/refactoring-expand.html">Comments</a>


        </p>
</div>
        

    </header>

    <div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p></p>
<p>So I have spent the past week refactoring expand so that you can have more control over what expansion methods you use.  With the present method, expand takes in hints which defaults to basic.  basic distributed multiplication over addition ($latex x(y+z) \rightarrow xy+xz$), expanded multinomial expressions ($latex (x+y)^2 \rightarrow x^2+2xy+y^2$), expanded logarithms ($latex \log{x^2} \rightarrow 2\log{x}$ and $latex \log{xy} \rightarrow \log{x}+\log{y}$), and expanded powers ($latex (xy)^n \rightarrow x^ny^n$ and $latex e^{x+y} \rightarrow e^{x}e^{y}$).  </p>
<p>If you wanted to do any of these things, you had to use expand_basic, which did all of them.  Also, you had no control on how deep the expansion went.  It went all they way down in recursion, so if you only wanted, for example, to distribute multiplication  on the top level, it was impossible.  </p>
<p>So I decided to start and fix <a href="http://code.google.com/p/sympy/issues/detail?id=1455">issue 1455</a>.  I now have a branch ready in my github account (see <a href="http://github.com/asmeurer/sympy/tree/expand">here</a>).  </p>
<p>With my patch, you can now choose to expand using each of the above individually with the log, mul, multinomial, power_exp, power_base.  In addition to this, you also now have complete control of how deep the expression recurses in the expand.  Previously, you couldn't, for example, expand $latex x(y+e^{x(y+z)})$ to $latex xy+xe^{x(y+z)}$. (It would also distribute the exponent, then expand to $latex e^{xy}e^{xz}$).  Now, you can choose to only distribute multiplication over addition, and to only do it on the top level.  </p>
<p><strong>Automatic expansion of exponents</strong></p>
<p>I mentioned above that expand would expand $latex e^{xy+xz}$ to $latex e^{xy}e^{xz}$. Actually, in the current version of SymPy, this would not happen because it automatically combines exponents like $latex e^{xy}e^{xz}$ to $latex e^{xy+xz}$.  </p>
<p>I have been working for the past few weeks changing this as per <a href="http://code.google.com/p/sympy/issues/detail?id=252&amp;q=asmeurer">issue 252</a>.   I have been mostly successful, except there are two nseries tests that I cannot figure out how to fix.  If you think you know why nseries would fail without automatic combining of exponents, please let me know.  The expand branch in my GitHub repo also has the exponent patches in it, if you want to see what I mean.  </p>
<p>Because some things, like the gruntz algorithm, rely on automatic combining of exponents, so I had to rework powsimp, which combined exponents but also combined bases ($latex x^ay^a$ to $latex (xy)^a$) so that it could only combine exponents.  That way, I could use it to get the old behavior where I needed it.  Use <code>powsimp(expr, deep=True, combine='exp')</code> in my branch to get the old automatic behavior.  </p>
<p><strong>So what does this have to do with ODEs?</strong></p>
<p>When I started working on separable equations, I wanted to be able to separate things like $latex e^{x+y}$ into $latex e^xe^y$, which is separable in $latex x$ and $latex y$.  So that is why I needed to refactor expand (I don't, for example, want to change $latex x(y+1)$ to $latex xy+x$ because the later is not easily recognizable as separate.  Doing this or course required that SymPy didn't automatically put back together $latex e^xe^y$ into $latex e^{x+y}$, so I had to fix that issue as well.  </p>
<p>I am almost finished implementing separable (there are some match issues that I will blog about later whenever I get them straightened out), and the only thing that is holding all of this back is those nseries tests.  If anyone is familiar with how those algorithms work and which parts require automatic combining of exponents, that would be great.  </p>
</div>
    </div>
    <aside class="postpromonav">
    <nav>
    
        <ul itemprop="keywords" class="tags">
           <li><a class="tag p-category" href="../../../../categories/mathjax.html" rel="tag">mathjax</a></li>
        </ul>

    
        <ul class="pager">
            <li class="previous">
                <a href="../13/vacation.html" rel="prev" title="Vacation">Previous post</a>
            </li>
            <li class="next">
                <a href="../22/how-to-permanently-lose-data-with-git-and-then-retrieve-it-again.html" rel="next" title="How to permanently lose data with git (and then retrieve it again)">Next post</a>
            </li>
        </ul>

    </nav>
    </aside>
        <section class="comments">
        <h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="nikolademo",
            disqus_url="http://asmeurersympy.wordpress.com/posts/2009/06/21/refactoring-expand.html",
        disqus_title="Refactoring Expand",
        disqus_identifier="cache/posts/2009/06/21/refactoring-expand.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section>
    
        <script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});</script>
        <script src="../../../../assets/js/mathjax.js"></script>

</article>

        
       <script>var disqus_shortname="nikolademo";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>



        </div>
        <!--End of body content-->

        <footer>
            Contents Â© 2014         <a href="mailto:asmeurer@gmail.com">Aaron Meurer</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
        </footer>
    </div>
</div>


            <script src="../../../../assets/js/all-nocdn.js"></script>
    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul>
<li>
<a class="addthis_button_facebook"></a>
</li>
<li>
<a class="addthis_button_google_plusone_share"></a>
</li>
<li>
<a class="addthis_button_linkedin"></a>
</li>
<li>
<a class="addthis_button_twitter"></a>
</li>
</ul>
</div>
<script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


    <script>jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
    

</body>
</html>
