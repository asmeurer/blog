<!DOCTYPE html>
<html prefix="            og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Automatically deploying this blog to GitHub Pages with Travis CI | Aaron Meurer's Blog</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://asmeurer.github.io/blog/posts/automatically-deploying-this-blog-to-github-pages-with-travis-ci/">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Aaron Meurer">
<link rel="prev" href="../github-reviews-gripes/" title="GitHub Reviews Gripes" type="text/html">
<meta property="og:site_name" content="Aaron Meurer's Blog">
<meta property="og:title" content="Automatically deploying this blog to GitHub Pages with Travis CI">
<meta property="og:url" content="https://asmeurer.github.io/blog/posts/automatically-deploying-this-blog-to-github-pages-with-travis-ci/">
<meta property="og:description" content="This blog is now deployed to GitHub pages automatically from Travis CI.
As I've outlined in the past,
is built with the Nikola static blogging
engine. I really like Nikola because it uses Python, has ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-06-19T14:21:32-05:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:site:id" content="123456">
<meta name="twitter:creator:id" content="654321">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
         
    <header id="header"><h1 id="brand"><a href="https://asmeurer.github.io/blog/" title="Aaron Meurer's Blog" rel="home">

        <span id="blog-title">Aaron Meurer's Blog</span>
    </a></h1>

        

        
    <nav id="menu"><ul>
<li><a href="../../">Blog</a></li>
                <li><a href="../../about">About</a></li>
                <li><a href="../../work">Work</a></li>
                <li><a href="../../archive.html">Archives</a></li>
                <li><a href="../../rss.xml">RSS</a></li>
    
    
    </ul></nav></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Automatically deploying this blog to GitHub Pages with Travis CI</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Aaron Meurer
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2017-06-19T14:21:32-05:00" itemprop="datePublished" title="2017-06-19 14:21">2017-06-19 14:21</time></a></p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/automatically-deploying-this-blog-to-github-pages-with-travis-ci.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.md" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>This blog is now <a href="http://travis-ci.org/asmeurer/blog">deployed to GitHub pages automatically</a> from Travis CI.</p>
<p>As I've outlined in the <a href="moving-to-github-pages-with-nikola/">past</a>,
is built with the <a href="https://getnikola.com/">Nikola</a> static blogging
engine. I really like Nikola because it uses Python, has lots of nice
extensions, and is <a href="https://github.com/getnikola/nikola/blob/master/LICENSE.txt">sanely
licensed</a>.</p>
<p>Most importantly, it is a static site generator, meaning I write my posts in
Markdown, and Nikola generates the site as static web content ("static" means no web server
is required to run the site). This means that the site can be hosted for free
on <a href="https://pages.github.com/">GitHub pages</a>. This is how this site has been
hosted since I started it. I have
a <a href="http://github.com/asmeurer/blog">GitHub repo</a> for the site, and the content
itself is deployed to
the <a href="https://github.com/asmeurer/blog/tree/gh-pages">gh-pages</a> branch of the
repo. But until now, the deployment has happened only manually with the
<code>nikola github_deploy</code> command.</p>
<p>A much better way is to deploy automatically using Travis CI. That way, I do
not need to run any software on my computer to deploy the blog.</p>
<p>The steps outlined here will work for any static site generator. They assume
you already have one set up and hosted on GitHub.</p>
<h3>Step 1: Create a .travis.yml file</h3>
<p><strong>Create a <code>.travis.yml</code> file like the one below</strong></p>
<pre><code class="language-yaml">sudo: false
language: python

python:
  - 3.6

install:
  - pip install "Nikola[extras]" doctr

script:
  - set -e
  - nikola build
  - doctr deploy . --built-docs output/
</code></pre>
<ul>
<li>If you use a different static site generator, replace <code>nikola</code> with that
site generator's command.</li>
<li>If you have Nikola configured to output to a different directory, or use a
different static site generator, replace <code>--built-docs output/</code> with the
directory where the site is built.</li>
<li>Add any extra packages you need to build your site to the <code>pip install</code>
command. For instance, I use the <code>commonmark</code> extension for Nikola, so I
need to install <code>commonmark</code>.</li>
<li>The <code>set -e</code> line is important. It will prevent the blog from being deployed
if the build fails.</li>
</ul>
<p><strong>Then go to <a href="http://www.asmeurer.com/blog/">https://travis-ci.org/profile/</a> and enable Travis for your blog
repo.</strong></p>
<h3>Step 2: Run doctr</h3>
<p>The key here is <a href="https://drdoctr.github.io/doctr/">doctr</a>, a tool I wrote with
<a href="https://github.com/gforsyth">Gil Forsyth</a> that makes deploying anything from
Travis CI to GitHub Pages a breeze. It automatically handles creating and
encrypting a deploy SSH key for GitHub, and the syncing of files to the
<code>gh-pages</code> branch.</p>
<p><strong>First install doctr.</strong> <code>doctr</code> requires
Python 3.5+, so you'll need that. You can install it with conda:</p>
<pre><code class="language-bash">conda install -c conda-forge doctr
</code></pre>
<p>or if you don't use conda, with pip</p>
<pre><code class="language-bash">pip install doctr
</code></pre>
<p><strong>Then run this command in your blog repo:</strong></p>
<pre><code class="language-bash">doctr configure
</code></pre>
<p>This will ask you for your GitHub username and password,
and for the name of the repo you are deploying from and to (for instance, for
my blog, I entered <code>asmeurer/blog</code>). The output will look something like this:</p>
<!-- http seems to give the least amount of highlighting. text is -->
<!-- supposed to work, but doesn't render correctly. -->
<pre><code class="language-http">$ doctr configure
What is your GitHub username? asmeurer
Enter the GitHub password for asmeurer:
A two-factor authentication code is required: app
Authentication code: 911451
What repo do you want to build the docs for (org/reponame, like 'drdoctr/doctr')? asmeurer/blog
What repo do you want to deploy the docs to? [asmeurer/blog] asmeurer/blog
Generating public/private rsa key pair.
Your identification has been saved in github_deploy_key.
Your public key has been saved in github_deploy_key.pub.
The key fingerprint is:
SHA256:4cscEfJCy9DTUb3DnPNfvbBHod2bqH7LEqz4BvBEkqc doctr deploy key for asmeurer/blog
The key's randomart image is:
+---[RSA 4096]----+
|    ..+.oo..     |
|     *o*..  .    |
|      O.+  o o   |
|     E + o  B  . |
|      + S .  +o +|
|       = o o o.o+|
|        * . . =.=|
|       . o ..+ =.|
|        o..o+oo  |
+----[SHA256]-----+

The deploy key has been added for asmeurer/blog.

You can go to https://github.com/asmeurer/blog/settings/keys to revoke the deploy key.

================== You should now do the following ==================

1. Commit the file github_deploy_key.enc.

2. Add

    script:
      - set -e
      - # Command to build your docs
      - pip install doctr
      - doctr deploy &lt;deploy_directory&gt;

to the docs build of your .travis.yml.  The 'set -e' prevents doctr from
running when the docs build fails. Use the 'script' section so that if
doctr fails it causes the build to fail.

3. Put

    env:
      global:
        - secure: "Kf8DlqFuQz9ekJXpd3Q9sW5cs+CvaHpsXPSz0QmSZ01HlA4iOtdWVvUttDNb6VGyR6DcAkXlADRf/KzvAJvaqUVotETJ1LD2SegnPzgdz4t8zK21DhKt29PtqndeUocTBA6B3x6KnACdBx4enmZMTafTNRX82RMppwqxSMqO8mA="

in your .travis.yml.
</code></pre>
<p>Follow the steps at the end of the command:</p>
<ol>
<li><strong>Commit the file <code>github_deploy_key.enc</code>.</strong></li>
<li>You already have <code>doctr deploy</code> in your <code>.travis.yml</code> from step 1 above.</li>
<li>
<strong>Add the <code>env</code> block to your <code>.travis.yml</code>.</strong> This will let Travis CI decrypt
the SSH key used to deploy to <code>gh-pages</code>.</li>
</ol>
<h3>That's it</h3>
<p>Doctr will now deploy your blog automatically. You may want to look at the
Travis build to make sure everything works. Note that <code>doctr</code> only deploys
from <code>master</code> by default (see below). You may also want to look at the
other
<a href="https://drdoctr.github.io/doctr/commandline.html#doctr-deploy">command line flags</a> for
<code>doctr deploy</code>, which let you do things such as to deploy to <code>gh-pages</code> for a
different repo than the one your blog is hosted on.</p>
<p>I recommend these steps over the ones in
the
<a href="https://getnikola.com/blog/automating-nikola-rebuilds-with-travis-ci.html">Nikola manual</a> because
doctr handles the SSH key generation for you, making things more secure. I
also found that the <code>nikola github_deploy</code> command
was <a href="https://github.com/getnikola/nikola/issues/2847">doing too much</a>, and
<code>doctr</code> handles syncing the built pages already anyway. Using <code>doctr</code> is much
simpler.</p>
<h3>Extra stuff</h3>
<h4>Reverting a build</h4>
<p>If a build goes wrong and you need to revert it, you'll need to use git to
revert the commit on your <code>gh-pages</code> branch. Unfortunately, GitHub doesn't
seem to have a way to revert commits in their web interface, so it has to be
done from the command line.</p>
<h4>Revoking the deploy key</h4>
<p>To revoke the deploy key generated by doctr, go your repo in GitHub, click on
"settings" and then "deploy keys". Do this if you decide to stop using this,
or if you feel the key may have been compromised. If you do this, the
deployment will stop until you run step 2 again to create a new key.</p>
<h4>Building the blog from branches</h4>
<p>You can also build your blog from branches, e.g., if you want to test things
out without deploying to the final repo.</p>
<p>We will use the steps
outlined
<a href="https://drdoctr.github.io/doctr/recipes.html#deploy-docs-from-any-branch">here</a>.</p>
<p>Replace the line</p>
<pre><code class="language-yaml">  - doctr deploy . --built-docs output/
</code></pre>
<p>in your <code>.travis.yml</code> with something like</p>
<pre><code class="language-yaml">  - if [[ "${TRAVIS_BRANCH}" == "master" ]]; then
      doctr deploy . --built-docs output/;
    else
      doctr deploy "branch-$TRAVIS_BRANCH" --built-docs output/ --no-require-master;
    fi
</code></pre>
<p>This will deploy your blog as normal from <code>master</code>, but from a branch it will
deploy to the <code>branch-&lt;branchname&gt;</code> subdir. For instance, my blog is at
<a href="http://www.asmeurer.com/blog/">http://www.asmeurer.com/blog/</a>, and if I had a branch called <code>test</code>, it would
deploy it to <a href=".">http://www.asmeurer.com/blog/branch-test/</a>.</p>
<p>Note that it will not delete old branches for you from <code>gh-pages</code>. You'll need
to do that manually once they are merged.</p>
<p>This only works for branches in the same repo. It is not possible to deploy
from a branch from pull request from a fork, for security purposes.</p>
<h4>Enable build cancellation in Travis</h4>
<p>If you go the Travis page for your blog and choose "settings" from the
hamburger menu, you can enable auto cancellation for branch builds. This will
make it so that if you push many changes in succession, only the most recent
one will get built. This makes the changes get built faster, and lets you
revert mistakes or typos without them ever actually being deployed.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../github-reviews-gripes/" rel="prev" title="GitHub Reviews Gripes">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="asmeurer",
            disqus_url="https://asmeurer.github.io/blog/posts/automatically-deploying-this-blog-to-github-pages-with-travis-ci/",
        disqus_title="Automatically deploying this blog to GitHub Pages with Travis CI",
        disqus_identifier="cache/posts/automatically-deploying-this-blog-to-github-pages-with-travis-ci.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="asmeurer";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script></main><footer id="footer"><p>Contents © 2017         <a href="mailto:asmeurer@gmail.com">Aaron Meurer</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
</p>
<p xmlns:dct="https://purl.org/dc/terms/" xmlns:vcard="https://www.w3.org/2001/vcard-rdf/3.0#">
  <a rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/">
    <img src="https://i.creativecommons.org/p/zero/1.0/88x31.png" style="border-style: none;" alt="CC0"></a>
</p>
            
        </footer>
</div>
    
    <div style="text-align:center">
<span class="st_twitterfollow_large" displaytext="Twitter Follow" st_username="asmeurer"></span>
<span class="st_twitter_large" displaytext="Tweet"></span>
<span class="st_googleplus_large" displaytext="Google +"></span>
<span class="st_plusone_large" displaytext="Google +1"></span>

<span class="st_email_large" displaytext="Email"></span>

</div>


        <script src="../../assets/js/baguetteBox.min.js"></script><script>baguetteBox.run('a.reference', {
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
